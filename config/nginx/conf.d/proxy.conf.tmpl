# This configuration file is autogenerated by the container startup script

# When a request is received from a trusted proxy (e.g., 10.0.0.0/8),
# NGINX will replace $remote_addr with the original client IP address
# provided in the configured real IP header (typically X-Forwarded-For).
# This ensures accurate client IP logging and correct IP-based access control.

real_ip_header {{ .Env.NGINX_REAL_IP_HEADER_NAME }};

# Declare trusted proxy networks.
# Only requests originating from these CIDR ranges are allowed
# to supply a replacement client IP via the real IP header.

{{ range (datasource "cidrs") }}
set_real_ip_from {{ . }};
{{- end }}

# real_ip_recursive behavior:
# - Disabled: NGINX uses the last IP address found in the header.
# - Enabled:  NGINX walks the X-Forwarded-For chain from right to left
#             and selects the first IP address that is not trusted.
# This setting is critical when multiple reverse proxies are involved.

real_ip_recursive {{ .Env.NGINX_REAL_IP_RECURSIVE }};